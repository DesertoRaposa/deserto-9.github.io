!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);class n{constructor(e,t,i,n,o,s,l){this.name=e,this.link=t,this.id=i,this.deletable=n,this.api=l,this.likeCount=o,this.isLiked=s,this.create()}like(){let e=this.likeIcon.classList.contains("place-card__like-icon_liked"),t=this;this.api.setUnsetLike(this.id,!e,(function(e){t.likeIcon.classList.toggle("place-card__like-icon_liked"),t.likeIcon.textContent=e.likes.length}))}remove(){let e=this;window.confirm("Do you really want удалить карточку?")&&this.api.deleteCard(this.id,(function(){e.html.remove()}))}create(){const e=document.createElement("div");e.classList.add("place-card");const t=document.createElement("div");t.classList.add("place-card__image"),t.style.backgroundImage="url("+this.link+")",e.appendChild(t);const i=document.createElement("div");i.classList.add("place-card__description"),e.appendChild(i);const n=document.createElement("h3");n.classList.add("place-card__name"),n.textContent=this.name,i.appendChild(n);const o=document.createElement("button");if(o.classList.add("place-card__like-icon"),this.isLiked&&o.classList.add("place-card__like-icon_liked"),o.textContent=this.likeCount,i.appendChild(o),this.likeIcon=o,this.html=e,o.addEventListener("click",this.like.bind(this)),this.deletable){const e=document.createElement("button");e.classList.add("place-card__delete-icon"),t.appendChild(e),e.addEventListener("click",this.remove.bind(this))}}}class o{constructor(e,t,i){this.typeOfPopup=e,this.cardList=t,this.api=i,0==this.typeOfPopup?(this.nameField=document.querySelector(".popup__input.popup__input_type_name"),this.linkField=document.querySelector(".popup__input.popup__input_type_link-url"),this.submit_button=document.querySelector(".button.popup__button"),this.close_button=document.querySelector(".popup__close")):(this.nameField=document.querySelector(".newpopup__input.newpopup__input_type_name"),this.linkField=document.querySelector(".newpopup__input.newpopup__input_type_link-url"),this.nameField_error=document.querySelector(".editformnameerror"),this.linkField_error=document.querySelector(".editformjoberror"),this.submit_button=document.querySelector(".button.submit__button"),this.close_button=document.querySelector(".newpopup__close")),this.submit_button.addEventListener("click",this.submit.bind(this)),this.close_button.addEventListener("click",this.close.bind(this)),this.nameField.addEventListener("input",this.validate.bind(this)),this.linkField.addEventListener("input",this.validate.bind(this)),this.prepare()}submit(e){if(e.preventDefault(),0==this.typeOfPopup){let e=this;this.api.addNewCard(this.nameField.value,this.linkField.value,(function(t){e.cardList.addcard(t.name,t.link,t._id,!0,0,!1,e.api)}))}else this.api.editInfo(this.nameField.value,this.linkField.value,(function(e){const t=document.querySelector(".user-info__name"),i=document.querySelector(".user-info__job");t.textContent=e.name,i.textContent=e.about}));this.close()}open(){if(0==this.typeOfPopup){document.querySelector(".popup").classList.add("popup_is-opened")}else{document.querySelector(".newpopup").classList.add("newpopup_is-opened")}}close(){if(0==this.typeOfPopup){document.querySelector(".popup").classList.remove("popup_is-opened")}else{document.querySelector(".newpopup").classList.remove("newpopup_is-opened")}}validate(){let e=this.checkField(this.nameField,this.nameField_error),t=this.checkField(this.linkField,this.linkField_error);e&&t?(this.submit_button.removeAttribute("disabled",!0),this.submit_button.classList.remove("popup__button_disabled")):(this.submit_button.setAttribute("disabled",!0),this.submit_button.classList.add("popup__button_disabled"))}checkField(e,t){let i="";return 0===e.value.length?i="Это обязательное поле":(e.value.length<2||e.value.length>30)&&(i="Должно быть от 2 до 30 символов"),e==this.linkField&&0==this.typeOfPopup&&e.value.length>30&&(i=""),null!=t&&(t.textContent=i),""==i}prepare(){if(0!=this.typeOfPopup){const e=document.querySelector(".user-info__name"),t=document.querySelector(".user-info__job");this.nameField.value=e.textContent,this.linkField.value=t.textContent}}}let s=new class{constructor(e){this.rootListElem=e}addcard(e,t,i,o,s,l){let c=new n(e,t,i,o,s,l,this.api);this.rootListElem.appendChild(c.html)}render(e,t){for(let i=0;i<e.length;i++){let n=e[i].likes,o=!1;for(let e=0;e<n.length;e++)n[e]._id==t&&(o=!0);this.addcard(e[i].name,e[i].link,e[i]._id,e[i].owner._id==t,e[i].likes.length,o)}}setApi(e){this.api=e,this.myID=e.myID;let t=this;this.api.loadCardsData((function(e){t.render(e,t.myID)}))}}(document.querySelector(".places-list"));const l=new class{constructor(e,t){this.baseURL=t,this.myToken=e}loadProfile(e){fetch(this.baseURL+"users/me",{headers:{authorization:this.myToken}}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).then(t=>{this.myID=t._id,e(t)}).catch(e=>{console.log(e)})}editInfo(e,t,i){fetch(this.baseURL+"users/me",{method:"PATCH",headers:{authorization:this.myToken,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).then(e=>{i(e)}).catch(e=>{console.log(e)})}loadCardsData(e){fetch(this.baseURL+"cards",{headers:{authorization:this.myToken}}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).then(t=>{e(t)}).catch(e=>{console.log(e)})}deleteCard(e,t){fetch(this.baseURL+"cards/"+e,{method:"DELETE",headers:{authorization:this.myToken,"Content-Type":"application/json"}}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).then(e=>{t(e)}).catch(e=>{console.log(e)})}addNewCard(e,t,i){fetch(this.baseURL+"cards",{method:"POST",headers:{authorization:this.myToken,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).then(e=>{i(e)}).catch(e=>{console.log(e)})}setUnsetLike(e,t,i){fetch(this.baseURL+"cards/like/"+e,{method:t?"PUT":"DELETE",headers:{authorization:this.myToken,"Content-Type":"application/json"}}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).then(e=>{i(e)}).catch(e=>{console.log(e)})}}("2374ea76-9940-4bf3-8811-73a7f8930642","http://95.216.175.5/cohort6/");l.loadProfile((function(e){const t=document.querySelector(".user-info__name"),i=document.querySelector(".user-info__job"),n=document.querySelector(".user-info__photo");t.textContent=e.name,i.textContent=e.about,n.style.backgroundImage="url(https://pictures.s3.yandex.net/frontend-developer/common/ava.jpg)",s.setApi(l)})),document.querySelector(".user-info__button").addEventListener("click",(function(e){new o(0,s,l).open()})),document.querySelector(".user-info__edit-button").addEventListener("click",(function(){new o(1,s,l).open()}));const c=document.querySelector(".imgpopup"),r=document.querySelector(".imgpopup__content"),a=document.querySelector(".imgpopup__close");document.querySelector(".places-list").addEventListener("click",(function(e){if(e.target.classList.contains("place-card__image")){const t=e.target.style.backgroundImage;r.style.backgroundImage=t,c.classList.add("imgpopup_is-opened")}})),a.addEventListener("click",(function(e){c.classList.remove("imgpopup_is-opened")}))}]);